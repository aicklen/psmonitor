<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>psmonitor: code/psmonitor/MonitorTask.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">psmonitor<span id="projectnumber">&#160;0.9</span>
   </div>
   <div id="projectbrief">Power supply voltage/current monitor</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('MonitorTask_8h.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">MonitorTask.h File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Header file for MonitorTask.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;LiquidCrystal.h&gt;</code><br />
</div>
<p><a href="MonitorTask_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="typedef-members" name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:ae6301da632235d9c40cc779a960b84fe" id="r_ae6301da632235d9c40cc779a960b84fe"><td class="memItemLeft" align="right" valign="top"><a id="ae6301da632235d9c40cc779a960b84fe" name="ae6301da632235d9c40cc779a960b84fe"></a>
typedef enum <a class="el" href="#a056784d438d0803937e8498cabe9d439">_select</a>&#160;</td><td class="memItemRight" valign="bottom"><b>MONITOR_SELECT_VALUE</b></td></tr>
<tr class="memdesc:ae6301da632235d9c40cc779a960b84fe"><td class="mdescLeft">&#160;</td><td class="mdescRight">Indexes into readings[] returned by Monitor task. <br /></td></tr>
<tr class="separator:ae6301da632235d9c40cc779a960b84fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="enum-members" name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:a056784d438d0803937e8498cabe9d439" id="r_a056784d438d0803937e8498cabe9d439"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a056784d438d0803937e8498cabe9d439">_select</a> { <b>MONITOR_VOLTAGE_POS</b> = 0
, <a class="el" href="#a056784d438d0803937e8498cabe9d439aeb8b808d675601700d9c758779fb0bfc">MONITOR_VOLTAGE_NEG</a> = 1
, <a class="el" href="#a056784d438d0803937e8498cabe9d439aac42d97617c32bbbf151b98a40449b80">MONITOR_CURRENT_POS</a> = 2
, <a class="el" href="#a056784d438d0803937e8498cabe9d439a046b9dd99f7ea1a5bcd79008e67114b4">MONITOR_CURRENT_NEG</a> = 3
 }</td></tr>
<tr class="memdesc:a056784d438d0803937e8498cabe9d439"><td class="mdescLeft">&#160;</td><td class="mdescRight">Indexes into readings[] returned by Monitor task.  <a href="#a056784d438d0803937e8498cabe9d439">More...</a><br /></td></tr>
<tr class="separator:a056784d438d0803937e8498cabe9d439"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a5354b0cc977afe61e47b082f08dbcb80" id="r_a5354b0cc977afe61e47b082f08dbcb80"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="MonitorTask_8cpp.html#a5354b0cc977afe61e47b082f08dbcb80">MonitorTask::setup</a> (unsigned long interval, uint8_t pos_addr, uint8_t neg_addr, LiquidCrystal *display)</td></tr>
<tr class="memdesc:a5354b0cc977afe61e47b082f08dbcb80"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configures the Monitor task basic operating parameters and LCD display.  <br /></td></tr>
<tr class="separator:a5354b0cc977afe61e47b082f08dbcb80"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a042ed723625dbcff52d8cb8def507736" id="r_a042ed723625dbcff52d8cb8def507736"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="MonitorTask_8cpp.html#a042ed723625dbcff52d8cb8def507736">MonitorTask::communicationOK</a> ()</td></tr>
<tr class="memdesc:a042ed723625dbcff52d8cb8def507736"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets the current state of communications with the INA260 sensors.  <br /></td></tr>
<tr class="separator:a042ed723625dbcff52d8cb8def507736"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4a03c93a2c529dbc728e30b0fa1ce0d4" id="r_a4a03c93a2c529dbc728e30b0fa1ce0d4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="MonitorTask_8cpp.html#a4a03c93a2c529dbc728e30b0fa1ce0d4">MonitorTask::setAveragingCount</a> (<a class="el" href="Adafruit__INA260_8h.html#ae48e22b52d5df9c826bcbdd9dce59bb7">INA260_AveragingCount</a> count)</td></tr>
<tr class="memdesc:a4a03c93a2c529dbc728e30b0fa1ce0d4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the number of samples to average.  <br /></td></tr>
<tr class="separator:a4a03c93a2c529dbc728e30b0fa1ce0d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c7ed68059744d001e782b27f26797d6" id="r_a3c7ed68059744d001e782b27f26797d6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="MonitorTask_8cpp.html#a3c7ed68059744d001e782b27f26797d6">MonitorTask::setConversionTime</a> (<a class="el" href="Adafruit__INA260_8h.html#afef2d924a64e9d6aae752de2321424e9">INA260_ConversionTime</a> conv)</td></tr>
<tr class="memdesc:a3c7ed68059744d001e782b27f26797d6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the time over which to measure the current and bus voltage samples.  <br /></td></tr>
<tr class="separator:a3c7ed68059744d001e782b27f26797d6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa848694eaaf58e5cb9c1d8646bebd0ed" id="r_aa848694eaaf58e5cb9c1d8646bebd0ed"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="MonitorTask_8cpp.html#aa848694eaaf58e5cb9c1d8646bebd0ed">MonitorTask::update</a> ()</td></tr>
<tr class="memdesc:aa848694eaaf58e5cb9c1d8646bebd0ed"><td class="mdescLeft">&#160;</td><td class="mdescRight">Called each time through the scheduling loop to implement monitoring.  <br /></td></tr>
<tr class="separator:aa848694eaaf58e5cb9c1d8646bebd0ed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc22bc7d529ec732e5f43a348e577f96" id="r_acc22bc7d529ec732e5f43a348e577f96"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="MonitorTask_8cpp.html#acc22bc7d529ec732e5f43a348e577f96">MonitorTask::getRawValues</a> (void)</td></tr>
<tr class="memdesc:acc22bc7d529ec732e5f43a348e577f96"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reads and returns the raw, unscaled and uncorrected ADC values for all measurements.  <br /></td></tr>
<tr class="separator:acc22bc7d529ec732e5f43a348e577f96"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Header file for MonitorTask. </p>
<dl class="section copyright"><dt>Copyright</dt><dd>Copyright 2024 Gregory Aicklen. Licensed under the MIT License</dd></dl>

<p class="definition">Definition in file <a class="el" href="MonitorTask_8h_source.html">MonitorTask.h</a>.</p>
</div><h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="a056784d438d0803937e8498cabe9d439" name="a056784d438d0803937e8498cabe9d439"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a056784d438d0803937e8498cabe9d439">&#9670;&#160;</a></span>_select</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="#a056784d438d0803937e8498cabe9d439">_select</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Indexes into readings[] returned by Monitor task. </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="a056784d438d0803937e8498cabe9d439aeb8b808d675601700d9c758779fb0bfc" name="a056784d438d0803937e8498cabe9d439aeb8b808d675601700d9c758779fb0bfc"></a>MONITOR_VOLTAGE_NEG&#160;</td><td class="fielddoc"><p>Index of positive voltage reading. </p>
</td></tr>
<tr><td class="fieldname"><a id="a056784d438d0803937e8498cabe9d439aac42d97617c32bbbf151b98a40449b80" name="a056784d438d0803937e8498cabe9d439aac42d97617c32bbbf151b98a40449b80"></a>MONITOR_CURRENT_POS&#160;</td><td class="fielddoc"><p>Index of negative voltage reading. </p>
</td></tr>
<tr><td class="fieldname"><a id="a056784d438d0803937e8498cabe9d439a046b9dd99f7ea1a5bcd79008e67114b4" name="a056784d438d0803937e8498cabe9d439a046b9dd99f7ea1a5bcd79008e67114b4"></a>MONITOR_CURRENT_NEG&#160;</td><td class="fielddoc"><p>Index of positive current reading. </p>
</td></tr>
</table>

<p class="definition">Definition at line <a class="el" href="MonitorTask_8h_source.html#l00018">18</a> of file <a class="el" href="MonitorTask_8h_source.html">MonitorTask.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a042ed723625dbcff52d8cb8def507736" name="a042ed723625dbcff52d8cb8def507736"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a042ed723625dbcff52d8cb8def507736">&#9670;&#160;</a></span>communicationOK()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool MonitorTask::communicationOK </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Gets the current state of communications with the INA260 sensors. </p>
<dl class="section return"><dt>Returns</dt><dd>State of communication with INA260 sensors </dd></dl>

<p class="definition">Definition at line <a class="el" href="MonitorTask_8cpp_source.html#l00119">119</a> of file <a class="el" href="MonitorTask_8cpp_source.html">MonitorTask.cpp</a>.</p>

</div>
</div>
<a id="acc22bc7d529ec732e5f43a348e577f96" name="acc22bc7d529ec732e5f43a348e577f96"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acc22bc7d529ec732e5f43a348e577f96">&#9670;&#160;</a></span>getRawValues()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MonitorTask::getRawValues </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reads and returns the raw, unscaled and uncorrected ADC values for all measurements. </p>
<p>Reads and returns the raw, unscaled and uncorrected ADC values for all measurements.</p>
<p>This function supports the Calibrate task and is safe to call after setup but when the Monitor task is not being scheduled (i.e. during calibration). Note that the global readings array is used here for raw readings, so this must not be called when the monitor task is being scheduled.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">readings[]</td><td>Returns results in global array </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MonitorTask_8cpp_source.html#l00233">233</a> of file <a class="el" href="MonitorTask_8cpp_source.html">MonitorTask.cpp</a>.</p>

</div>
</div>
<a id="a4a03c93a2c529dbc728e30b0fa1ce0d4" name="a4a03c93a2c529dbc728e30b0fa1ce0d4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4a03c93a2c529dbc728e30b0fa1ce0d4">&#9670;&#160;</a></span>setAveragingCount()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MonitorTask::setAveragingCount </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="Adafruit__INA260_8h.html#ae48e22b52d5df9c826bcbdd9dce59bb7">INA260_AveragingCount</a></td>          <td class="paramname"><span class="paramname"><em>count</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the number of samples to average. </p>

<p class="definition">Definition at line <a class="el" href="MonitorTask_8cpp_source.html#l00127">127</a> of file <a class="el" href="MonitorTask_8cpp_source.html">MonitorTask.cpp</a>.</p>

</div>
</div>
<a id="a3c7ed68059744d001e782b27f26797d6" name="a3c7ed68059744d001e782b27f26797d6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c7ed68059744d001e782b27f26797d6">&#9670;&#160;</a></span>setConversionTime()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MonitorTask::setConversionTime </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="Adafruit__INA260_8h.html#afef2d924a64e9d6aae752de2321424e9">INA260_ConversionTime</a></td>          <td class="paramname"><span class="paramname"><em>conv</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the time over which to measure the current and bus voltage samples. </p>

<p class="definition">Definition at line <a class="el" href="MonitorTask_8cpp_source.html#l00136">136</a> of file <a class="el" href="MonitorTask_8cpp_source.html">MonitorTask.cpp</a>.</p>

</div>
</div>
<a id="a5354b0cc977afe61e47b082f08dbcb80" name="a5354b0cc977afe61e47b082f08dbcb80"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5354b0cc977afe61e47b082f08dbcb80">&#9670;&#160;</a></span>setup()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MonitorTask::setup </td>
          <td>(</td>
          <td class="paramtype">unsigned long</td>          <td class="paramname"><span class="paramname"><em>interval</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>pos_addr</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>neg_addr</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LiquidCrystal *</td>          <td class="paramname"><span class="paramname"><em>display</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Configures the Monitor task basic operating parameters and LCD display. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">interval</td><td>Time in milliseconds between task runs </td></tr>
    <tr><td class="paramname">pos_addr</td><td>I2C address of positive voltage/current INA260 sensor </td></tr>
    <tr><td class="paramname">neg_addr</td><td>I2C address of negative voltage/current INA260 sensor </td></tr>
    <tr><td class="paramname">display</td><td>Pointer to the LCD display object</td></tr>
  </table>
  </dd>
</dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000003">Todo</a></b></dt><dd>Retrieve calibration data from EEPROM </dd></dl>

<p class="definition">Definition at line <a class="el" href="MonitorTask_8cpp_source.html#l00093">93</a> of file <a class="el" href="MonitorTask_8cpp_source.html">MonitorTask.cpp</a>.</p>

</div>
</div>
<a id="aa848694eaaf58e5cb9c1d8646bebd0ed" name="aa848694eaaf58e5cb9c1d8646bebd0ed"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa848694eaaf58e5cb9c1d8646bebd0ed">&#9670;&#160;</a></span>update()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MonitorTask::update </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Called each time through the scheduling loop to implement monitoring. </p>
<p>Implements the MonitorTask main function to display current and voltage for both positive and negative supplies. Runs whenever the scheduler transfers control to the MonitorTask and determines if it is time to run; if not time to run, immediately relinquishes control back to the scheduler. </p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000004">Todo</a></b></dt><dd>Use calibration data to correct positive current reading </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000005">Todo</a></b></dt><dd>Use calibration data to correct negative current reading </dd></dl>

<p class="definition">Definition at line <a class="el" href="MonitorTask_8cpp_source.html#l00151">151</a> of file <a class="el" href="MonitorTask_8cpp_source.html">MonitorTask.cpp</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_050edd66366d13764f98250ef6db77f6.html">code</a></li><li class="navelem"><a class="el" href="dir_13eaa5f1e417dcbd48f3ae56ada896da.html">psmonitor</a></li><li class="navelem"><a class="el" href="MonitorTask_8h.html">MonitorTask.h</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
